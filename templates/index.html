<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="google-site-verification" content="Sq4aw55_6yf_231cHOyw1m5daRLidQMopOzQJf6Z9zI" />
  <title>Render Chat App - Free Real-Time Messaging Platform</title>
  <link rel="icon" href="https://i.postimg.cc/nVmZ1VCy/130e91956494570-file-0000000071b861f5b05f18218ed05aa5-wm.png">
<meta name="description" content="Render Chat App is a free real-time messaging platform to chat online with friends, create groups, and stay connected. Fast, secure, and easy-to-use chat app for seamless communication anytime, anywhere." />
<meta name="keywords" content="chat app, real-time messaging, online chat, group chat, instant messaging, secure chat, free chat app,Chat-verse, Chatverse, Render Chat App" />
<meta name="author" content="Render Chat App Team" />
<meta name="robots" content="index, follow" />

<!-- Open Graph (Facebook, WhatsApp, LinkedIn) -->
<meta property="og:title" content="Render Chat App - Free Real-Time Messaging" />
<meta property="og:description" content="Chat online with friends, create groups, and stay connected with Render Chat App. Fast, secure, and easy-to-use real-time chat experience." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://render-chat-app-rb18.onrender.com/" />
<meta property="og:image" content="https://i.postimg.cc/mZzs31yy/a79998359f0a8ae-file-000000001b2461f8b67453828725f925-wm.png" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Render Chat App - Free Real-Time Messaging" />
<meta name="twitter:description" content="Fast, secure, and easy-to-use chat app for seamless communication anytime, anywhere." />
<meta name="twitter:image" content="https://i.postimg.cc/mZzs31yy/a79998359f0a8ae-file-000000001b2461f8b67453828725f925-wm.png" />
  <title>Chat App</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/anuragl2h/Discord-bot-lavajukebox@6ae3cf8ebae3a907b31afb551aea25a785914c3b/static/future-ui-FULL.js" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/anuragl2h/Discord-bot-lavajukebox@775c4d342d5b30a5471dc374f8a613a3ba8a0151/static/future-ui-FULL.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Baloo+2:wght@400;600&family=Nunito:wght@400;700&family=Chewy&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <style>
    /* --- your existing CSS unchanged --- */
    .fu-modal-close { display: none; }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: radial-gradient(circle at top right, purple, #2F3560, #2D334A, #272C44, #28304A); height: 100vh; }
    .div1 { display: grid; margin: 1vh; border-radius: 5vh; color: white; place-items: center; height: 10vh; width: 90%; place-self: center; }
    h1 { font-size: 5.75vh; font-weight: 400; place-self: center; font-family: 'Poppins', sans-serif; margin-left: -3vh; }
    .main { z-index: 6; max-height: 100vh; height: 90%; position: relative; }
    #messages { border: 1px solid #28304A; box-shadow: 1px 2px 3px black; position: absolute; top: 12vh; bottom: 12vh; left: 2vh; right: 2vh; overflow-y: auto; padding: 10px; background: transparent; backdrop-filter: blur(20px); border-radius: 10px; color: white; display: flex; flex-direction: column; gap: 6px; }
    .msg { background: var(--bg); color: #dcddde; max-width: max-content; padding: 12px 14px; border-radius: 12px; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.35); position: relative; transition: background 0.2s ease; }
    .msg:hover { background: #3a3c42; }
    .msg::after { content: ""; position: absolute; left: -8px; bottom: 8px; width: 16px; height: 14px; background: var(--bg); clip-path: polygon(100% 0, 0 50%, 100% 100%); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.35)); }
    .msg.me { align-self: flex-end; --bg: #5865f2; color: #fff; }
    .msg.me:hover { background: #6873f5; }
    .msg.me::after { left: auto; right: -8px; transform: scaleX(-1); }
    .chatbox { position: absolute; bottom: 1vh; left: 1.5vh; right: 12vh; border: 0.75px solid #2F3560; height: 10vh; border-radius: 5vh; background: transparent; backdrop-filter: blur(20px); display: flex; align-items: center; padding: 0 3vh; transition: background-color 1s ease; }
    .chatbox:hover { background: #2F3560; }
    .input { width: 100%; font-size: 3vh; border: none; outline: none; background: transparent; color: skyblue; }
    .submit { position: absolute; bottom: 1vh; right: 1.5vh; height: 10vh; width: 10vh; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; background: transparent; backdrop-filter: blur(20px); transition: background-color 0.3s ease; border: 0.75px solid #2F3560; }
    .submit1 { font-size: 3.5vh; border: none; background-color: transparent; color: lightblue; }
    .submit1:focus { outline: none; }
    .submit:hover { background: rgb(27,131,212); }
    .td { display: grid; place-items: end; position: absolute; top: 2.5vh; right: 2.25vh; width: 4vh; height: 4vh; cursor: pointer; }
    .td dt { height: 5px; width: 100%; background: black; border-radius: 5px; transition: 0.4s; }
    .td.ro dt:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
    .td.ro dt:nth-child(2) { opacity: 0; }
    .td.ro dt:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
    .header { background-color: black; height: max-content; width: max-content; padding: 5px; position: fixed; top: 12.5vh; right: 1vh; opacity: 0; z-index: -1; border: 1px solid purple; display: grid; place-items: center; transition: transform .2s ease; transform: translateY(-8px); }
    .header.open { opacity: 1; z-index: 99; transform: translateY(0); background: #333; backdrop-filter: blur(20px); border: 1px solid purple; border-radius: 2vh; padding: 15px; color: white; }
    ul { list-style: none; margin-left: 5px; padding: 0px; font-family: Poppins; font-weight: 500; }
    li, a { font-size: 2.75vh; background: transparent; color: white; text-decoration: none; }
    a:focus { text-decoration: none; }
    .rules { background: rgba(0,0,0,0.5); color: cyan; border: 2px solid blue; border-radius: 8px; padding: 10px; margin: 10px; font-size: 2vh; box-shadow: 0 0 10px cyan; }
    .rules h3 { margin-bottom: 6px; font-size: 2.5vh; text-align: center; }
    #rule { justify-self: start; vertical-align: center; }
    #onlineUsers { margin-top: 10px; padding: 10px; border-top: 1px solid purple; }
    #onlineUsers li { font-size: 2.5vh; color: blue; padding: 5px 0; }
  </style>
</head>
<body>
  <div class="header" id="menu">
    <ul>
      <li><a href="#" id="usersButton"> üü¢ Online</a></li>
      <li><a href="https://L2hport.is-a.dev">Portfolio</a></li>
      <li><a href="https://anuragl2h.github.io/L2h-anitrest/index.html">Anime Story</a></li>
      <li><a href="https://discord.gg/urRpFsdJ">Join Discord</a></li>
      <li><a href="#" id="set">‚öôÔ∏è Setting </a></li>
      <li><a id="rule" class="fu-bell-count">‚ö†Ô∏è Rules</a></li>
    </ul>
  </div>

  <ul id="onlineUsers" style="display:none;"></ul>

  <div class="main">
    <div class="div1">
      <h1>Chat Verse</h1>
      <section class="td" id="menuBtn" aria-label="Open menu">
        <dt></dt><dt></dt><dt></dt>
      </section>
    </div>

    <div id="messages"></div>

    <div class="chatbox">
      <input type="text" id="message" name="message" placeholder="send.." class="input" autocomplete="off">
    </div>
    <div class="submit">
      <button class="submit1" id="sendBtn" aria-label="Send">‚û§</button>
    </div>
  </div>
  <div id="fu-container"></div>

  <script>
    $(function(){
      let name = localStorage.getItem("UserName");
      const socket = io("/", { query: `username=${name || 'Anonymous'}` });

      if (!name) {
        $('#message, #sendBtn').prop('disabled', true);
        $.futureUImodal({
          title: "Enter Your Name",
          content: '<input id="inp" class="fu-input" placeholder="whats your name bro/sis" autofocus><button class="fu-btn" id="nameSubmit">Submit</button>',
          autoClose: false
        });
      }

      $(document).on('click', '#nameSubmit', function(){
        const val = $("#inp").val().trim();
        if (!val) {
          $.futureUItoast("Please enter a name!");
          return;
        }
        name = val || "Anonymous";
        localStorage.setItem("UserName", name);
        socket.disconnect();
        socket.io.opts.query = `username=${name}`;
        socket.connect();
        $('.fu-modal-close').click();
        $('#message, #sendBtn').prop('disabled', false);
        loadHistory(); // reload messages after username is set
      });
      // --- Load saved history from /history ---
      function loadHistory() {
    $.get("/history", function(data) {
        messages.empty();
        const history = data.history.reverse();
        history.forEach(function(msg) {
            const isSelf = msg.username === name;
            // FIX: Pass the entire message object which now includes the ID
            appendMessage(msg, isSelf, msg.id);
        });
    });
    }
      // Load history immediately if username exists
      if (name) loadHistory();

      // Online users list
      socket.on("update_users", function(users){
        const ul = $("#onlineUsers");
        ul.empty();
        users.forEach(user => $("<li>").text(user).appendTo(ul));
      });

      $(document).on("click", "#usersButton", function() {
        const onlineList = $("#onlineUsers").clone().show();
        $.futureUImodal({
          title: "Online Users",
          content: onlineList.prop("outerHTML") + `<button id="closeModal" class="fu-btn">Close</button>`,
          autoClose: false
        });
        $(document).on("click", "#closeModal", () => $(".fu-modal-close").click());
      });

      // Receive live messages
      socket.on("message", function(msg){
        const isMe = msg.startsWith(name + ": ");
        const div = $("<div>").addClass("msg").text(msg);
        if(isMe) div.addClass("me");
        $("#messages").append(div);
        $("#messages").scrollTop($("#messages")[0].scrollHeight);
      });

      // Send message
      function sendMessage(){
        const msg = $("#message").val().trim();
        if(!msg) return;
        const abusiveWords = ["mc","bc","gandu","chutiya","madarchod","bhosdike","randi","lund","fuck","porn","sex","nude","bhadua"];
        let isAbusive = abusiveWords.some(word => msg.toLowerCase().includes(word));
        if(isAbusive){
          $.futureUItoast("No abusive word allowed");
          return;
        }
        socket.send(msg);
        $("#message").val("").focus();
      }
      // Listen for a double-click event on any message
$(document).on("dblclick", ".message", function() {
    // Get the unique ID from the data-id attribute
    const messageId = $(this).data("id");

    // Check if the message has an ID (history messages don't)
    if (messageId) {
        // Confirm with the user before deleting
        if (confirm("Are you sure you want to delete this message?")) {
            // Emit a "delete_message" event to the server
            socket.emit("delete_message", messageId);
        }
    } else {
        alert("Cannot delete a message from history.");
    }
});

// Listen for a "message_deleted" event from the server
socket.on("message_deleted", function(id) {
    // Find the message by its data-id and remove it from the UI
    $(`li[data-id="${id}"]`).remove();
});
function appendMessage(msg, isSelf, id) {
    const liClass = isSelf ? "self" : "other";
    // Use the id parameter to set the data-id attribute
    const messageHtml = `<li class="message ${liClass}" data-id="${id}"><span class="username">${msg.username}:</span><span class="content">${msg.message}</span></li>`;
    messages.append(messageHtml);
    messages.scrollTop(messages.prop("scrollHeight"));
}

socket.on("message", function(msg) {
    const isSelf = msg.username === name;
    // Call appendMessage, passing the ID from the server
    appendMessage(msg, isSelf, msg.id);
});
      $(".submit").on("click", sendMessage);
      $("#message").on("keydown", e => { if(e.key === "Enter"){ e.preventDefault(); sendMessage(); } });

      // Menu toggle
      $("#menuBtn").on("click", function(){
        $("#menu").toggleClass("open");
        $(this).toggleClass("ro");
      });

      $(document).on("click", function(e){
        if(!$(e.target).closest("#menu, #menuBtn").length){
          if($("#menu").hasClass("open")){
            $("#menu").removeClass("open");
            $("#menuBtn").removeClass("ro");
          }
        }
      });

      $(document).on("keydown", function(e){
        if(e.key === "Escape" && $("#menu").hasClass("open")){
          $("#menu").removeClass("open");
          $("#menuBtn").removeClass("ro");
        }
      });

      // Change username
      $(document).on("click", "#set", function(){
        $.futureUImodal({
          title: "Setting change username",
          content: `<input id="ni" class="fu-input" placeholder="New username" autofocus><button id="close" class="fu-btn">submit</button>  <button class="fu-btn moc">Close</button>`,
          autoClose: false
        });
      });

      $(document).on("click", "#close", function(){
        const val = $('#ni').val().trim();
        name = val || "Anonymous";
        localStorage.setItem("UserName", name);
        socket.disconnect();
        socket.io.opts.query = `username=${name}`;
        socket.connect();
        $.futureUItoast("Username successfully changed");
        $('.fu-modal-close').click();
        loadHistory();
      });

      $(document).on("click", ".moc", () => $('.fu-modal-close').click());

      $(document).on("click", "#rule", function(){
        $.futureUImodal({
          title: "rules",
          content: `<div class="rules"><h3>üö´ No abusive language<br>üö´ No personal info<br>üö´ No links</h3></div><button class="fu-btn moc">close</button>`,
          autoClose: false
        });
      });
    });
  </script>
</body>
</html>
