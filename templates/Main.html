<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A new web page">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="favicon.ico">
    <script src="https://kit.fontawesome.com/549f2c4b6c.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>

    <title>Chatbot</title>
    <style>
        /* Modern Chatbot Theme */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: system-ui, sans-serif; 
            background: linear-gradient(90deg, #00C9FF 0%, #92FE9D 100%); 
            color: black; 
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1.6;
        }
        section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            height: 80vh;
            width: 90%;
            max-width: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .chat-area {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 20px;
            line-height: 1.4;
        }
        .message.user {
            background-color: #0b93f6;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        .message.ai {
            background-color: #e5e5ea;
            color: black;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        .cont {
            background-color: #fff;
            padding: 15px;
            border-top: 1px solid #e0e0e0;
        }
        #chat-form {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="text"] {
            flex-grow: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus {
            border-color: #0b93f6;
        }
        .btn {
            border: none;
            color: blue;
            background-color: white;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
            transform: rotate(45deg);
        }
        .btn:hover {
            background-color: white;
        }
        .str{
          padding-bottom: 1vh;
        }
        .ai_msg{
          align-self: left;
          padding: 1.5vh;
          background-color: skyblue;
        }
        header{
          color: darkblue;
          border-radius: 2vh;
          
          padding: 0.5vh 1.5vh;
          position: absolute;
          top: 2vh;
        }
        .button{
          background-color:transparent;
          border-radius: 1vh;
          padding: 1vh 1.5vh;
          border: 1px solid blue;
          position: absolute;
          top: 2vh;
          left: 1vh;
        }
        a{
          text-decoration: none;
          display; inline;
          color: purple;
        }
    </style>
</head>
<body>
  <button class="button"><a href="/" ><h4><i class="fa-solid fa-arrow-left"></i></h4><h6>Home</h6></a></button>
  <header><h1>L2H AI <i class="fa-solid fa-comments"></i></h1></header>
    <section>
        <div class="chat-area" data-markdown="{{ text | safe }}">
          
          {{ text }}
            </div>
        <div class="cont">
            <form id="chat-form" action="/submit" method="post">
                <input type="text" name="user_text" placeholder="Type your message...">
                <button type="submit" class="btn"><i class="fa-solid fa-paper-plane"></i></button>
            </form>
        </div>
    </section>
<script>
    const chatForm = document.getElementById("chat-form");
    const chatArea = document.querySelector(".chat-area");
    const chatInput = document.querySelector('input[name="user_text"]');

    chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        // Display user's message immediately
        const userDiv = document.createElement("div");
        userDiv.classList.add("message", "user");
        userDiv.textContent = userMessage;
        chatArea.appendChild(userDiv);

        chatInput.value = ""; // Clear the input field

        try {
            const response = await fetch("/submit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ user_text: userMessage }),
            });

            if (!response.ok) {
                throw new Error("Network response was not ok");
            }

            const data = await response.json();

            // Display AI's response
            const aiDiv = document.createElement("div");
            aiDiv.classList.add("message", "ai");
            aiDiv.innerHTML = '<strong class="str">L2H AI</strong>'+ marked.parse(data.ai_response);
            chatArea.appendChild(aiDiv);
            
            chatArea.scrollTop = chatArea.scrollHeight; // Scroll to the bottom
        } catch (error) {
            console.error("Error:", error);
            const errorDiv = document.createElement("div");
            errorDiv.classList.add("message", "ai");
            errorDiv.textContent = `‚ùå An error occurred: ${error.message}`;
            chatArea.appendChild(errorDiv);
        }
    });
</script>
</body>
</html>